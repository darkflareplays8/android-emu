[supervisord]
nodaemon=true
logfile=/var/log/supervisord.log
logfile_maxbytes=10MB
loglevel=warn

[program:xvfb]
command=/usr/bin/Xvfb :0 -screen 0 720x1280x24 -ac +extension GLX +render -noreset
autorestart=true
priority=100
stdout_logfile=/dev/null
stderr_logfile=/dev/null

[program:emulator]
command=/bin/bash -c "sleep 5 && emulator -avd android_device -no-window -no-audio -gpu swiftshader_indirect -no-boot-anim -memory 1536 -cores 2 -no-snapshot -no-accel"
environment=DISPLAY=":0",ANDROID_HOME="/opt/android-sdk",PATH="/opt/android-sdk/emulator:/opt/android-sdk/platform-tools:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
autorestart=true
priority=200
stdout_logfile=/var/log/emulator.log
stderr_logfile=/var/log/emulator.log
stdout_logfile_maxbytes=5MB

[program:x11vnc]
command=/bin/bash -c "sleep 15 && x11vnc -display :0 -forever -nopw -shared -rfbport 5900 -noxdamage -quiet"
autorestart=true
priority=300
stdout_logfile=/dev/null
stderr_logfile=/dev/null

[program:websockify]
command=/bin/bash -c "sleep 18 && websockify --web=/opt/novnc 6080 localhost:5900"
autorestart=true
priority=400
stdout_logfile=/dev/null
stderr_logfile=/dev/null

[program:nodeserver]
command=node /app/server.js
directory=/app
autorestart=true
priority=500
stdout_logfile=/var/log/nodeserver.log
stderr_logfile=/var/log/nodeserver.log
stdout_logfile_maxbytes=5MB
