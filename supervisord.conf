[supervisord]
nodaemon=true
logfile=/var/log/supervisord.log
logfile_maxbytes=50MB
loglevel=info

[program:xvfb]
command=/usr/bin/Xvfb :0 -screen 0 1080x1920x24 -ac +extension GLX +render -noreset
autorestart=true
priority=100
stdout_logfile=/var/log/xvfb.log
stderr_logfile=/var/log/xvfb.err

[program:emulator]
command=/bin/bash -c "sleep 5 && emulator -avd android_device -no-window -no-audio -gpu swiftshader_indirect -no-boot-anim -memory 2048 -cores 2 -no-snapshot"
environment=DISPLAY=":0",ANDROID_HOME="/opt/android-sdk",PATH="/opt/android-sdk/emulator:/opt/android-sdk/platform-tools:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
autorestart=true
priority=200
stdout_logfile=/var/log/emulator.log
stderr_logfile=/var/log/emulator.err

[program:x11vnc]
command=/bin/bash -c "sleep 15 && x11vnc -display :0 -forever -nopw -shared -rfbport 5900 -noxdamage"
autorestart=true
priority=300
stdout_logfile=/var/log/x11vnc.log
stderr_logfile=/var/log/x11vnc.err

[program:websockify]
command=/bin/bash -c "sleep 18 && websockify --web=/opt/novnc 6080 localhost:5900"
autorestart=true
priority=400
stdout_logfile=/var/log/websockify.log
stderr_logfile=/var/log/websockify.err

[program:nodeserver]
command=node /app/server.js
directory=/app
autorestart=true
priority=500
stdout_logfile=/var/log/nodeserver.log
stderr_logfile=/var/log/nodeserver.err
